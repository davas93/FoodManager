<div class="container">

  @if (diningTableData$ | async; as data) {
    @if (!data.isWeekend) {
      <div class="table-top-service">
        <h2>{{ data.currentDate }}</h2>

        <p-iconField iconPosition="left" class="ml-auto">
          <p-inputIcon>
            <i class="fi fi-rr-search"></i>
          </p-inputIcon>
          <input #search
                 pInputText
                 type="text"
                 placeholder="Поиск"
                 (input)="dt.filterGlobal(search.value, 'contains')"/>
        </p-iconField>
      </div>

      <div class="table-container">
        <p-table #dt
                 styleClass="p-datatable-gridlines"
                 [value]="data.menus"
                 [globalFilterFields]="['employeeName']">
          <ng-template pTemplate="header">
            <tr>
              <th class="sticky-left">№ п/п</th>
              <th>ФИО</th>
              <th>Первое</th>
              <th>Второе</th>
              <th>Гарнир</th>
              <th>Салат</th>
            </tr>
          </ng-template>
          <ng-template let-userMenu pTemplate="body" let-rowIndex="rowIndex">
            <tr>
              <td class="sticky-left">{{ rowIndex + 1 }}</td>
              <td [title]="userMenu.employeeName">
                {{ userMenu.employeeName }}
              </td>
              <td [title]="userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.firstCourse">
                {{ userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.firstCourse || 'Нет' }}
              </td>
              <td [title]="userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.secondCourse">
                {{ userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.secondCourse || 'Нет' }}
              </td>
              <td [title]="userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.sideDish">
                {{ userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.sideDish || 'Нет' }}
              </td>
              <td [title]="userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.salad">
                {{ userMenu.weeks[data.weekIndex].days[data.dayIndex].meals.salad || 'Нет' }}
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="footer">
            <tr>
              <td colspan="2" [attr.rowspan]="getMaxFooterRows(data.mealCounts).length + 1" class="group-cell">Блюда и
                количество
              </td>
            </tr>
            @for (row of getMaxFooterRows(data.mealCounts); track row; let i = $index) {
              <tr class="course-names">
                <td [title]="Object.keys(data.mealCounts.firstCourse)[i + 1] || ''">
                  <div class="cell-wrapper">
                    <span class="course-name">{{ Object.keys(data.mealCounts.firstCourse)[i + 1] }}</span>
                    <span class="course-total">{{ Object.values(data.mealCounts.firstCourse)[i + 1] }}</span>
                  </div>
                </td>
                <td [title]="Object.keys(data.mealCounts.secondCourse)[i + 1] || ''">
                  <div class="cell-wrapper">
                    <span class="course-name">{{ Object.keys(data.mealCounts.secondCourse)[i + 1] }}</span>
                    <span class="course-total">{{ Object.values(data.mealCounts.secondCourse)[i + 1] }}</span>
                  </div>
                </td>
                <td [title]="Object.keys(data.mealCounts.sideDish)[i + 1] || ''">
                  <div class="cell-wrapper">
                    <span class="course-name">{{ Object.keys(data.mealCounts.sideDish)[i + 1] }}</span>
                    <span class="course-total">{{ Object.values(data.mealCounts.sideDish)[i + 1] }}</span>
                  </div>
                </td>
                <td [title]="Object.keys(data.mealCounts.salad)[i + 1] || ''">
                  <div class="cell-wrapper">
                    <span class="course-name">{{ Object.keys(data.mealCounts.salad)[i + 1] }}</span>
                    <span class="course-total">{{ Object.values(data.mealCounts.salad)[i + 1] }}</span>
                  </div>
                </td>
              </tr>
            }
            <tr class="">
              <td colspan="2">Всего</td>
              <td class="text-right">{{ data.mealCounts.firstCourse.total }}</td>
              <td class="text-right">{{ data.mealCounts.secondCourse.total }}</td>
              <td class="text-right">{{ data.mealCounts.sideDish.total }}</td>
              <td class="text-right">{{ data.mealCounts.salad.total }}</td>
            </tr>
            <tr>
              <td colspan="6" class="total text-right">
                Общее количество комплексных обедов: {{ data.mealCounts.complexMeals.total }}
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    } @else {
      <p>Сегодня выходной, отдыхайте!</p>
    }
  } @else {
    <app-loading-screen></app-loading-screen>
  }
</div>
