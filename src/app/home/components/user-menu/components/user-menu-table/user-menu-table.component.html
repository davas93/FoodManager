<p-tabView [(activeIndex)]="_currentWeekIndex">
  @for (week of weeks$ | async; track week; let i = $index) {
    <p-tabPanel [header]="week.displayName" class="menu-tabs">
      @if (generalMenu$ | async; as generalMenu) {
        <p-table #table [value]="week.days"
                 groupRowsBy="name"
                 rowGroupMode="subheader" (onEditComplete)="changeMenu.emit()">
          <ng-template pTemplate="header">
            <tr>
              <th style="width:25%">
                Первое
              </th>
              <th style="width:25%">
                Второе
              </th>
              <th style="width:25%">
                Гарнир
              </th>
              <th style="width:25%">
                Салат
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="groupheader" let-weekDay>
            <tr pRowGroupHeader class="group-header">
              <td colspan="5">
                <span class="font-bold ml-2">{{ weekDay.displayName }}</span>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-weekDay let-rowIndex="rowIndex">
            <tr>
              <td #cell [pEditableColumn]="weekDay.meals.firstCourse" pEditableColumnField="firstCourse">
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown placeholder="Выберите блюдо"
                                appendTo="body"
                                [disabled]="weekDay.meals.salad ==='САЛАТ'"
                                [overlayOptions]="{styleClass: 'user-menu-table-dropdown-overlay'}"
                                [options]="[''].concat(generalMenu.weeks[i].days[rowIndex].meals.firstCourse)"
                                [(ngModel)]="weekDay.meals.firstCourse">
                      <ng-template let-option pTemplate="item">
                        <span [title]="option" class="dropdown-item">
                          {{ option ? option : "Нет" }}
                        </span>
                      </ng-template>
                      <ng-template let-selectedOption pTemplate="selectedItem">
                        <span [title]="selectedOption" class="dropdown-item">
                          {{ selectedOption ? selectedOption : "" }}
                        </span>
                      </ng-template>
                    </p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                  <span>
                    {{ weekDay.meals.firstCourse || 'Нет' }}
                  </span>
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]="weekDay.meals.secondCourse" pEditableColumnField="secondCourse">
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown placeholder="Выберите блюдо"
                                appendTo="body"
                                [disabled]="weekDay.meals.salad ==='САЛАТ'"
                                [overlayOptions]="{styleClass: 'user-menu-table-dropdown-overlay'}"
                                [options]="[''].concat(generalMenu.weeks[i].days[rowIndex].meals.secondCourse)"
                                [(ngModel)]="weekDay.meals.secondCourse">
                      <ng-template let-option pTemplate="item">
                        <span [title]="option" class="dropdown-item">
                          {{ option ? option : "Нет" }}
                        </span>
                      </ng-template>
                      <ng-template let-selectedOption pTemplate="selectedItem">
                        <span [title]="selectedOption" class="dropdown-item">
                          {{ selectedOption ? selectedOption : "" }}
                        </span>
                      </ng-template>
                    </p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                  <span>
                    {{ weekDay.meals.secondCourse || 'Нет' }}
                  </span>
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]="weekDay.meals.sideDish" pEditableColumnField="sideDish">
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown placeholder="Выберите блюдо"
                                appendTo="body"
                                [disabled]="weekDay.meals.salad ==='САЛАТ'"
                                [overlayOptions]="{styleClass: 'user-menu-table-dropdown-overlay'}"
                                [options]="[''].concat(generalMenu.weeks[i].days[rowIndex].meals.sideDish)"
                                [(ngModel)]="weekDay.meals.sideDish">
                      <ng-template let-option pTemplate="item">
                        <span [title]="option" class="dropdown-item">
                          {{ option ? option : "Нет" }}
                        </span>
                      </ng-template>
                      <ng-template let-selectedOption pTemplate="selectedItem">
                        <span [title]="selectedOption" class="dropdown-item">
                          {{ selectedOption ? selectedOption : "" }}
                        </span>
                      </ng-template>
                    </p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                  <span>
                    {{ weekDay.meals.sideDish || 'Нет' }}
                  </span>
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]="weekDay.meals.salad" pEditableColumnField="salad">
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown placeholder="Выберите блюдо"
                                appendTo="body"
                                [overlayOptions]="{styleClass: 'user-menu-table-dropdown-overlay'}"
                                [options]="[''].concat(generalMenu.weeks[i].days[rowIndex].meals.salad)"
                                [(ngModel)]="weekDay.meals.salad"
                                (ngModelChange)="onSaladChange(weekDay, $event)">
                      <ng-template let-option pTemplate="item">
                        <span [title]="option" class="dropdown-item">
                          {{ option ? option : "Нет" }}
                        </span>
                      </ng-template>
                      <ng-template let-selectedOption pTemplate="selectedItem">
                        <span [title]="selectedOption" class="dropdown-item">
                          {{ selectedOption ? selectedOption : "" }}
                        </span>
                      </ng-template>
                    </p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                  <span>
                    {{ weekDay.meals.salad || 'Нет' }}
                  </span>
                  </ng-template>
                </p-cellEditor>
              </td>
            </tr>
          </ng-template>
        </p-table>
      } @else {
        Основное меню не составлено
      }
    </p-tabPanel>
  }
</p-tabView>
